# Checkout to Payment - WITH LATENCY DATA
# Short-lag edge (~3 days median) for testing query functionality
# Contains both cohort and window slices for dual-slice retrieval testing

id: checkout-to-payment-latency
name: Checkout to Payment Rate (with Latency)
type: probability
query: "from(checkout).to(payment)"
query_overridden: false

# Edge-level latency config (enables latency tracking)
latency:
  maturity_days: 10
  anchor_node_id: landing-page

values:
  # ============================================================
  # COHORT SLICE (A-anchored: landing-page → checkout → payment)
  # 90-day cohort window for mature baseline
  # ============================================================
  - sliceDSL: 'cohort(landing-page,1-Sep-25:30-Nov-25)'
    mean: 0.742
    stdev: 0.025
    n: 4850
    k: 3599
    cohort_from: '1-Sep-25'
    cohort_to: '30-Nov-25'
    
    # Per-day cohort data (showing representative sample - full would have 91 entries)
    dates:
      - '1-Sep-25'
      - '2-Sep-25'
      - '3-Sep-25'
      - '10-Sep-25'
      - '20-Sep-25'
      - '1-Oct-25'
      - '15-Oct-25'
      - '1-Nov-25'
      - '15-Nov-25'
      - '20-Nov-25'
      - '25-Nov-25'
      - '28-Nov-25'
      - '30-Nov-25'
    
    n_daily: [52, 48, 55, 61, 58, 54, 62, 57, 53, 49, 51, 47, 45]
    k_daily: [39, 36, 41, 46, 44, 41, 47, 43, 39, 35, 32, 22, 12]
    
    # Per-cohort latency (checkout → payment lag)
    median_lag_days: [2.8, 2.9, 2.7, 3.0, 2.8, 2.9, 3.1, 2.8, 3.0, 3.2, 3.5, 4.1, 5.0]
    mean_lag_days: [3.2, 3.4, 3.1, 3.5, 3.3, 3.4, 3.6, 3.2, 3.5, 3.8, 4.2, 5.0, 6.2]
    
    # Anchor path latency (landing-page → checkout lag)
    anchor_n_daily: [145, 138, 152, 168, 161, 150, 172, 158, 147, 136, 142, 131, 125]
    anchor_median_lag_days: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    anchor_mean_lag_days: [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]
    
    # Slice-level latency summary
    latency:
      median_lag_days: 3.0
      mean_lag_days: 3.5
      t95: 10.2
      completeness: 0.92
      histogram:
        total_converters: 3599
        bins:
          - { day: 1, count: 324 }
          - { day: 2, count: 1152 }
          - { day: 3, count: 1080 }
          - { day: 4, count: 540 }
          - { day: 5, count: 288 }
          - { day: 6, count: 108 }
          - { day: 7, count: 54 }
          - { day_range: [8, 14], count: 53 }
    
    # Anchor path latency summary
    anchor_latency:
      median_lag_days: 0.1
      mean_lag_days: 0.2
      histogram:
        total_converters: 4850
        bins:
          - { day: 0, count: 4365 }
          - { day: 1, count: 485 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-01T08:00:00Z'
      full_query: 'from(landing-page).to(checkout).to(payment).cohort(1-Sep-25:30-Nov-25)'

  # ============================================================
  # WINDOW SLICE (X-anchored: checkout → payment)
  # 7-day recent events for current rate
  # ============================================================
  - sliceDSL: 'window(25-Nov-25:1-Dec-25)'
    mean: 0.689
    stdev: 0.042
    n: 385
    k: 265
    window_from: '25-Nov-25'
    window_to: '1-Dec-25'
    
    dates:
      - '25-Nov-25'
      - '26-Nov-25'
      - '27-Nov-25'
      - '28-Nov-25'
      - '29-Nov-25'
      - '30-Nov-25'
      - '1-Dec-25'
    
    n_daily: [51, 58, 62, 55, 49, 54, 56]
    k_daily: [32, 38, 42, 36, 28, 35, 34]
    
    # Forecast (mature baseline p∞)
    forecast: 0.745
    
    # Window-level latency
    latency:
      median_lag_days: 3.1
      mean_lag_days: 3.6
      t95: 10.5
      histogram:
        total_converters: 265
        bins:
          - { day: 1, count: 24 }
          - { day: 2, count: 85 }
          - { day: 3, count: 80 }
          - { day: 4, count: 40 }
          - { day: 5, count: 21 }
          - { day: 6, count: 8 }
          - { day_range: [7, 10], count: 7 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-02T08:00:00Z'
      full_query: 'from(checkout).to(payment).window(25-Nov-25:1-Dec-25)'

  # ============================================================
  # CONTEXT SLICE: channel:google (cohort)
  # Testing context filtering
  # ============================================================
  - sliceDSL: 'cohort(landing-page,1-Sep-25:30-Nov-25).context(channel:google)'
    mean: 0.768
    stdev: 0.031
    n: 1820
    k: 1398
    cohort_from: '1-Sep-25'
    cohort_to: '30-Nov-25'
    
    dates:
      - '1-Sep-25'
      - '15-Sep-25'
      - '1-Oct-25'
      - '15-Oct-25'
      - '1-Nov-25'
      - '15-Nov-25'
      - '30-Nov-25'
    
    n_daily: [19, 22, 21, 24, 22, 20, 17]
    k_daily: [15, 17, 16, 19, 17, 15, 11]
    
    median_lag_days: [2.6, 2.7, 2.8, 2.9, 2.7, 3.0, 4.8]
    mean_lag_days: [3.0, 3.2, 3.3, 3.4, 3.2, 3.5, 5.9]
    
    anchor_n_daily: [53, 61, 58, 67, 61, 56, 47]
    anchor_median_lag_days: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    anchor_mean_lag_days: [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]
    
    latency:
      median_lag_days: 2.9
      mean_lag_days: 3.4
      t95: 9.8
      completeness: 0.94
      histogram:
        total_converters: 1398
        bins:
          - { day: 1, count: 140 }
          - { day: 2, count: 447 }
          - { day: 3, count: 420 }
          - { day: 4, count: 210 }
          - { day: 5, count: 112 }
          - { day: 6, count: 42 }
          - { day_range: [7, 14], count: 27 }
    
    anchor_latency:
      median_lag_days: 0.1
      mean_lag_days: 0.2
      histogram:
        total_converters: 1820
        bins:
          - { day: 0, count: 1638 }
          - { day: 1, count: 182 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-01T08:00:00Z'
      full_query: 'from(landing-page).to(checkout).to(payment).cohort(1-Sep-25:30-Nov-25).context(channel:google)'

  # ============================================================
  # CONTEXT SLICE: channel:organic (cohort)
  # Different channel for comparison
  # ============================================================
  - sliceDSL: 'cohort(landing-page,1-Sep-25:30-Nov-25).context(channel:organic)'
    mean: 0.712
    stdev: 0.035
    n: 1450
    k: 1032
    cohort_from: '1-Sep-25'
    cohort_to: '30-Nov-25'
    
    dates:
      - '1-Sep-25'
      - '15-Sep-25'
      - '1-Oct-25'
      - '15-Oct-25'
      - '1-Nov-25'
      - '15-Nov-25'
      - '30-Nov-25'
    
    n_daily: [15, 18, 17, 20, 18, 16, 14]
    k_daily: [11, 13, 12, 14, 13, 11, 8]
    
    median_lag_days: [3.1, 3.2, 3.0, 3.3, 3.1, 3.4, 5.2]
    mean_lag_days: [3.6, 3.8, 3.5, 3.9, 3.6, 4.0, 6.4]
    
    anchor_n_daily: [42, 50, 47, 56, 50, 44, 39]
    anchor_median_lag_days: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
    anchor_mean_lag_days: [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]
    
    latency:
      median_lag_days: 3.2
      mean_lag_days: 3.8
      t95: 11.0
      completeness: 0.89
      histogram:
        total_converters: 1032
        bins:
          - { day: 1, count: 82 }
          - { day: 2, count: 310 }
          - { day: 3, count: 320 }
          - { day: 4, count: 165 }
          - { day: 5, count: 93 }
          - { day: 6, count: 36 }
          - { day_range: [7, 14], count: 26 }
    
    anchor_latency:
      median_lag_days: 0.1
      mean_lag_days: 0.2
      histogram:
        total_converters: 1450
        bins:
          - { day: 0, count: 1305 }
          - { day: 1, count: 145 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-01T08:00:00Z'
      full_query: 'from(landing-page).to(checkout).to(payment).cohort(1-Sep-25:30-Nov-25).context(channel:organic)'

  # ============================================================
  # CONTEXT WINDOW SLICE: channel:google
  # Provides p_∞ baseline for cohort(...).context(channel:google)
  # ============================================================
  - sliceDSL: 'window(25-Nov-25:1-Dec-25).context(channel:google)'
    mean: 0.705
    stdev: 0.045
    n: 140
    k: 99
    window_from: '25-Nov-25'
    window_to: '1-Dec-25'
    
    dates:
      - '25-Nov-25'
      - '26-Nov-25'
      - '27-Nov-25'
      - '28-Nov-25'
      - '29-Nov-25'
      - '30-Nov-25'
      - '1-Dec-25'
    
    n_daily: [20, 21, 22, 19, 18, 20, 20]
    k_daily: [14, 15, 16, 13, 11, 15, 15]
    
    # Forecast (mature baseline p∞) for google channel
    forecast: 0.772
    
    latency:
      median_lag_days: 3.0
      mean_lag_days: 3.5
      t95: 10.0
      histogram:
        total_converters: 99
        bins:
          - { day: 1, count: 9 }
          - { day: 2, count: 32 }
          - { day: 3, count: 30 }
          - { day: 4, count: 16 }
          - { day: 5, count: 8 }
          - { day_range: [6, 10], count: 4 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-02T08:00:00Z'
      full_query: 'from(checkout).to(payment).window(25-Nov-25:1-Dec-25).context(channel:google)'

  # ============================================================
  # CONTEXT WINDOW SLICE: channel:organic
  # Provides p_∞ baseline for cohort(...).context(channel:organic)
  # ============================================================
  - sliceDSL: 'window(25-Nov-25:1-Dec-25).context(channel:organic)'
    mean: 0.675
    stdev: 0.048
    n: 110
    k: 74
    window_from: '25-Nov-25'
    window_to: '1-Dec-25'
    
    dates:
      - '25-Nov-25'
      - '26-Nov-25'
      - '27-Nov-25'
      - '28-Nov-25'
      - '29-Nov-25'
      - '30-Nov-25'
      - '1-Dec-25'
    
    n_daily: [15, 17, 18, 16, 14, 15, 15]
    k_daily: [10, 12, 12, 11, 10, 10, 9]
    
    forecast: 0.695
    
    latency:
      median_lag_days: 3.3
      mean_lag_days: 3.7
      t95: 11.0
      histogram:
        total_converters: 74
        bins:
          - { day: 1, count: 6 }
          - { day: 2, count: 24 }
          - { day: 3, count: 22 }
          - { day: 4, count: 11 }
          - { day: 5, count: 7 }
          - { day_range: [6, 11], count: 4 }
    
    data_source:
      type: amplitude
      retrieved_at: '2025-12-02T08:00:00Z'
      full_query: 'from(checkout).to(payment).window(25-Nov-25:1-Dec-25).context(channel:organic)'

metadata:
  description: >
    Checkout-to-payment conversion with full latency tracking. Short-lag edge 
    (~3 days median) representing typical web checkout behaviour. Contains 
    cohort data for forecasting immature cohorts and window data for recent 
    event rates. Includes channel context slices for testing context filtering.
  tags:
    - conversion
    - checkout
    - payment
    - latency
    - short-lag
  created_at: '2025-01-01T00:00:00Z'
  updated_at: '2025-12-02T08:00:00Z'
  author: analytics-team
  version: '2.0.0'
  status: active


# Registry Index Schema
# This schema defines the structure for the main parameter registry index
# that tracks all parameters in the system.

type: object
required: [version, created_at, parameters]
additionalProperties: false

properties:
  version:
    type: string
    pattern: '^\d+\.\d+\.\d+$'
    description: "Semantic version of the registry schema"
    examples: ["1.0.0", "1.2.3", "2.0.0"]
  
  created_at:
    type: string
    format: date-time
    description: "ISO 8601 timestamp when registry was created"
  
  updated_at:
    type: string
    format: date-time
    description: "ISO 8601 timestamp when registry was last updated"
  
  parameters:
    type: array
    description: "List of all parameters in the registry"
    items:
      type: object
      required: [id, file_path, type, status]
      additionalProperties: false
      properties:
        id:
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
          description: "Unique parameter identifier"
        
        file_path:
          type: string
          pattern: '^parameters/[^/]+/[^/]+\\.yaml$'
          description: "Relative path to parameter definition file"
          examples: ["parameters/probability/conversion-rate-baseline.yaml"]
        
        type:
          type: string
          enum: [probability, cost_gbp, cost_time, standard_deviation]
          description: "Parameter type classification"
        
        status:
          type: string
          enum: [active, deprecated, draft, archived]
          description: "Current status of the parameter"
        
        aliases:
          type: array
          items:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
          uniqueItems: true
          description: "Alternative identifiers for this parameter"
        
        dependencies:
          type: array
          items:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
          uniqueItems: true
          description: "List of parameter IDs this parameter depends on"
        
        tags:
          type: array
          items:
            type: string
            pattern: '^[a-zA-Z0-9_-]+$'
          uniqueItems: true
          description: "Tags for categorization and search"
        
        created_at:
          type: string
          format: date-time
          description: "When this parameter was added to the registry"
        
        updated_at:
          type: string
          format: date-time
          description: "When this parameter was last updated in the registry"
        
        author:
          type: string
          minLength: 2
          maxLength: 64
          description: "Author or team responsible for this parameter"
        
        version:
          type: string
          pattern: '^\d+\.\d+\.\d+$'
          description: "Version of the parameter definition"
        
        usage_count:
          type: integer
          minimum: 0
          description: "Number of graphs currently using this parameter"
        
        last_used:
          type: string
          format: date-time
          description: "When this parameter was last used in a graph"
        
        validation_status:
          type: string
          enum: [valid, invalid, warning, pending]
          default: "pending"
          description: "Current validation status of the parameter"
        
        validation_errors:
          type: array
          items:
            type: string
          description: "List of validation errors (if any)"
        
        metadata_summary:
          type: object
          properties:
            has_data_source:
              type: boolean
              description: "Whether parameter has a configured data source"
            has_analytics:
              type: boolean
              description: "Whether parameter has analytics configuration"
            is_auto_updated:
              type: boolean
              description: "Whether parameter is automatically updated"
            confidence_level:
              type: string
              enum: [low, medium, high, very_high]
              description: "Confidence level in parameter value"
          additionalProperties: false

# Example valid registry index
examples:
  - version: "1.0.0"
    created_at: "2025-01-15T10:00:00Z"
    updated_at: "2025-01-15T15:30:00Z"
    parameters:
      - id: conversion-rate-baseline
        file_path: "parameters/probability/conversion-rate-baseline.yaml"
        type: probability
        status: active
        aliases: ["baseline-conversion", "checkout-rate"]
        dependencies: []
        tags: ["conversion", "checkout", "baseline"]
        created_at: "2025-01-15T10:00:00Z"
        updated_at: "2025-01-15T10:00:00Z"
        author: "data-team"
        version: "1.0.0"
        usage_count: 5
        last_used: "2025-01-15T14:20:00Z"
        validation_status: "valid"
        validation_errors: []
        metadata_summary:
          has_data_source: true
          has_analytics: true
          is_auto_updated: true
          confidence_level: "high"
      
      - id: email-campaign-cost
        file_path: "parameters/cost/email-campaign-cost.yaml"
        type: cost
        status: active
        aliases: ["email-cost", "campaign-cost"]
        dependencies: []
        tags: ["email", "marketing", "cost"]
        created_at: "2025-01-15T11:00:00Z"
        updated_at: "2025-01-15T11:00:00Z"
        author: "marketing-team"
        version: "1.0.0"
        usage_count: 3
        last_used: "2025-01-15T13:45:00Z"
        validation_status: "valid"
        validation_errors: []
        metadata_summary:
          has_data_source: true
          has_analytics: false
          is_auto_updated: false
          confidence_level: "medium"

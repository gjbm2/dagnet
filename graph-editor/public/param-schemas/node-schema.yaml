$schema: http://json-schema.org/draft-07/schema#
title: Node Definition
description: Nodes are used to define the nodes in the conversion graph. They are also used to store node name mappings and property filters for Amplitude queries, as well as case variants (experiments).

type: object
required:
  - id
  - name
  - metadata

properties:
  id:
    type: string
    pattern: ^[a-z0-9-]+$
    description: Unique identifier for the node (matches node IDs in graphs)
    
  name:
    type: string
    minLength: 1
    description: Human-readable name for the node
    
  description:
    type: string
    description: Detailed description of what this node represents
  
  event_id:
    type: string
    pattern: ^[a-z0-9_]+$
    description: |
      Reference to event in events registry (allows underscore for production event names).
      Links this node to an analytics event for data retrieval.
    examples: ["checkout_started", "purchase_completed", "page_view"]
    
  tags:
    type: array
    items:
      type: string
    description: Tags for categorization and search
    
  resources:
    type: array
    description: External resources related to this node
    items:
      type: object
      required:
        - type
        - url
      properties:
        type:
          type: string
          enum: [notion, figma, miro, confluence, docs, jira, slack, other]
          description: Type of resource
        url:
          type: string
          format: uri
          description: URL to the resource
        title:
          type: string
          description: Optional title for the resource
        description:
          type: string
          description: Optional description of the resource
  
  url:
    type: string
    format: uri
    description: External URL for this node (e.g., Notion page, documentation)
  
  images:
    type: array
    description: Images attached to this node
    items:
      type: object
      required:
        - image_id
        - caption
      properties:
        image_id:
          type: string
          pattern: ^[a-z0-9-]+$
          description: Unique identifier for the image (used as filename)
        caption:
          type: string
          maxLength: 256
          description: Caption/description for the image
        file_extension:
          type: string
          enum: [png, jpg, jpeg]
          description: Image file extension
        uploaded_at:
          type: string
          format: date-time
          description: When this image was uploaded
        uploaded_by:
          type: string
          description: User who uploaded the image
          
  metadata:
    type: object
    description: Metadata about this node definition
    required: [created_at, version]
    properties:
      created_at:
        type: string
        format: date-time
        description: When this definition was created
      updated_at:
        type: string
        format: date-time
        description: When this definition was last updated
      author:
        type: string
        minLength: 2
        maxLength: 64
        description: Author of this definition
      version:
        type: string
        pattern: ^\d+\.\d+\.\d+$
        description: Semantic version identifier
        examples: ["1.0.0", "1.2.3"]
      status:
        type: string
        enum: [active, deprecated, archived]
        default: active
        description: Status of this node definition

examples:
  # Minimal example for new node creation (used as default template)
  - id: example-node
    name: "Example Node"
    metadata:
      created_at: "2025-01-01T00:00:00Z"
      updated_at: "2025-01-01T00:00:00Z"
      version: "1.0.0"



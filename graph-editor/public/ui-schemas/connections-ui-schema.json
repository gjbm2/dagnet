{
  "connections": {
    "ui:options": {
      "orderable": true,
      "tabField": "name"
    },
    "items": {
      "ui:title": " ",
      "name": {
        "ui:title": "Connection Name",
        "ui:help": "Unique identifier (kebab-case). Example: amplitude-prod, sheets-readonly"
      },
      "provider": {
        "ui:title": "Provider Type",
        "ui:help": "Data source provider. Common values: amplitude, google-sheets, statsig, postgres"
      },
      "kind": {
        "ui:widget": "radio",
        "ui:help": "Connection type: 'http' for REST APIs, 'sql' for databases"
      },
      "description": {
        "ui:widget": "textarea",
        "ui:options": {
          "rows": 2
        }
      },
      "enabled": {
        "ui:help": "Set to false to disable this connection without deleting it"
      },
      "credsRef": {
        "ui:help": "Reference to credentials.yaml entry. Leave empty for public APIs."
      },
      "defaults": {
        "ui:widget": "MonacoWidget",
        "ui:options": {
          "language": "json",
          "height": "200px",
          "showLabel": true
        },
        "ui:help": "Default values merged into all requests (e.g., project_id, base_url, global filters)"
      },
      "connection_string_schema": {
        "ui:widget": "MonacoWidget",
        "ui:options": {
          "language": "json",
          "height": "300px",
          "showLabel": true
        },
        "ui:help": "JSON Schema defining per-parameter connection_string overrides"
      },
      "adapter": {
        "ui:options": {
          "accordion": true
        },
        "ui:help": "DAS adapter specification for data fetching and transformation.\n\nðŸ“– Full template documentation:\nSee PROJECT_CONNECT/CURRENT/DAS_DETAILED_DESIGN/MUSTACHE_TEMPLATE_SPEC.md",
        "pre_request": {
          "ui:options": {
            "accordion": true
          },
          "script": {
            "ui:widget": "MonacoWidget",
            "ui:options": {
              "language": "javascript",
              "height": "400px",
              "showLabel": true,
              "wordWrap": "on"
            },
            "ui:help": "JavaScript to transform query before request. MUST return modified dsl.\n\nAvailable in scope: dsl, window, context, defaults, connection_string\n\nCommon uses:\nâ€¢ Date formatting: dsl.start_date = window.start.split('T')[0];\nâ€¢ JSON serialization: dsl.events_json = JSON.stringify(events);\nâ€¢ Build arrays: dsl.funnel = [visited, from, to];\n\nExample:\nconst formatDate = (iso) => iso.split('T')[0].replace(/-/g, '');\ndsl.start_date = formatDate(window.start);\ndsl.end_date = formatDate(window.end);\nreturn dsl;"
          }
        },
        "request": {
          "ui:options": {
            "accordion": true
          },
          "url_template": {
            "ui:help": "Mustache template for request URL.\n\nAvailable variables:\nâ€¢ {{credentials.field}} - From credentials.yaml providers section\nâ€¢ {{dsl.from_event_id}} - Source event from query\nâ€¢ {{dsl.to_event_id}} - Target event from query\nâ€¢ {{window.start}} - ISO datetime (e.g. 2024-01-01T00:00:00Z)\nâ€¢ {{window.end}} - ISO datetime\nâ€¢ {{defaults.field}} - From connection defaults\nâ€¢ {{connection_string.field}} - From parameter overrides\n\nExample:\n{{defaults.base_url}}/api/funnels?key={{credentials.api_key}}"
          },
          "method": {
            "ui:widget": "radio"
          },
          "headers": {
            "ui:widget": "MonacoWidget",
            "ui:options": {
              "language": "json",
              "height": "150px"
            },
            "ui:help": "HTTP headers as JSON. Values support Mustache templates.\n\nExamples:\nâ€¢ Bearer: \"Authorization\": \"Bearer {{credentials.access_token}}\"\nâ€¢ Basic Auth: \"Authorization\": \"Basic {{credentials.basic_auth_b64}}\"\nâ€¢ API Key: \"X-API-Key\": \"{{credentials.api_key}}\"\nâ€¢ Custom: \"Content-Type\": \"application/json\""
          },
          "body_template": {
            "ui:widget": "MonacoWidget",
            "ui:options": {
              "language": "json",
              "height": "400px",
              "showLabel": true,
              "wordWrap": "on"
            },
            "ui:help": "Mustache template for request body. Output must be valid JSON.\n\nAvailable variables: same as url_template above.\n\nFor complex JSON (arrays/objects), use pre_request to serialize:\n  dsl.events_json = JSON.stringify(events);\n  return dsl;\nThen: {{{dsl.events_json}}} (triple braces for unescaped)\n\nExample:\n{\n  \"event_type\": \"{{dsl.from_event_id}}\",\n  \"start\": \"{{window.start}}\"\n}"
          }
        },
        "response": {
          "ui:options": {
            "accordion": true
          },
          "ok_when": {
            "ui:options": {
              "accordion": true
            },
            "status": {
              "ui:options": {
                "orderable": true
              },
              "ui:help": "Acceptable HTTP status codes (e.g., [200, 201])"
            },
            "jmes": {
              "ui:widget": "MonacoWidget",
              "ui:options": {
                "language": "jmespath",
                "height": "100px"
              },
              "ui:help": "JMESPath expression that should evaluate to truthy for success"
            }
          },
          "extract": {
            "ui:options": {
              "accordion": true
            },
            "jmes": {
              "ui:widget": "MonacoWidget",
              "ui:options": {
                "language": "json",
                "height": "200px"
              },
              "ui:help": "Map of variable_name: jmespath_expression to extract values from response"
            }
          }
        },
        "transform": {
          "ui:options": {
            "accordion": true
          },
          "steps": {
            "ui:options": {
              "orderable": true,
              "tabField": "var"
            },
            "items": {
              "ui:title": " ",
              "var": {
                "ui:help": "Variable name to store result"
              },
              "jsonata": {
                "ui:widget": "MonacoWidget",
                "ui:options": {
                  "language": "jsonata",
                  "height": "100px"
                },
                "ui:help": "JSONata expression to compute derived value"
              }
            }
          }
        },
        "upsert": {
          "ui:options": {
            "accordion": true
          },
          "mappings": {
            "ui:options": {
              "orderable": true,
              "tabField": "from"
            },
            "items": {
              "ui:title": " ",
              "from": {
                "ui:help": "Variable name from transform phase"
              },
              "to": {
                "ui:help": "JSON Pointer to target location in graph (e.g., /edges/{{edgeId}}/p/mean)"
              }
            }
          }
        }
      }
    }
  }
}

